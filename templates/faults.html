{% extends 'base.html' %}

{% block title %}דיווח תקלות - DormitoriesPlus{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/forms.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="hero">
        <h2>דיווח תקלות</h2>
    </div>

    <div class="info-box" role="complementary" aria-label="פרטי משתמש">
        <h3>הפרטים שלך:</h3>
        <ul>
            <li>שם: {{ user.first_name }} {{ user.last_name }}</li>
            {% if user_room and user_building %}
                <li>בניין: {{ user_building }}</li>
                <li>חדר: {{ user_room }}</li>
            {% else %}
                <li>אין לך שיבוץ חדר במערכת. אנא פנה למנהל המעונות.</li>
            {% endif %}
        </ul>
    </div>

    <form method="post" class="fault-form" role="form" aria-label="טופס דיווח תקלה">
        {% csrf_token %}
        <div class="form-group">
            <label for="fault_type" id="fault-type-label">סוג התקלה:</label>
            <select id="fault_type" name="fault_type" required
                    aria-labelledby="fault-type-label"
                    aria-required="true">
                <option value="">בחר סוג תקלה</option>
                <option value="electrical">תקלה חשמלית</option>
                <option value="plumbing">תקלה בצנרת</option>
                <option value="furniture">תקלה בריהוט</option>
                <option value="other">אחר</option>
            </select>
        </div>

        <div class="form-group">
            <label for="fault_description" id="fault-description-label">תיאור התקלה:</label>
            <textarea id="fault_description" name="fault_description" required
                      aria-labelledby="fault-description-label"
                      aria-required="true"
                      rows="4"></textarea>
        </div>

        <div class="form-group">
            <label for="urgency" id="urgency-label">דחיפות:</label>
            <select id="urgency" name="urgency" required
                    aria-labelledby="urgency-label"
                    aria-required="true">
                <option value="">בחר דחיפות</option>
                <option value="low">נמוכה</option>
                <option value="medium">בינונית</option>
                <option value="high">גבוהה</option>
            </select>
        </div>

        <button type="submit" class="submit-btn" aria-label="שלח דיווח תקלה">שלח דיווח</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.querySelector('.fault-form').addEventListener('submit', function(e) {
        const faultType = document.getElementById('fault_type');
        const faultDescription = document.getElementById('fault_description');
        const urgency = document.getElementById('urgency');
        let isValid = true;

        // Reset aria-invalid states
        [faultType, faultDescription, urgency].forEach(field => {
            field.setAttribute('aria-invalid', 'false');
        });

        // Validate fields
        if (!faultType.value) {
            faultType.setAttribute('aria-invalid', 'true');
            isValid = false;
        }

        if (!faultDescription.value.trim()) {
            faultDescription.setAttribute('aria-invalid', 'true');
            isValid = false;
        }

        if (!urgency.value) {
            urgency.setAttribute('aria-invalid', 'true');
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            alert('אנא מלא את כל השדות הנדרשים');
        }
    });
</script>
{% endblock %}