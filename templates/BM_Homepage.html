{% extends 'base.html' %}
{% load inventory_tags %}
{% load static %}

{% block title %}עמוד ראשי לאחראי הבניין{% endblock %}

{% block content %}
<div class="container">
    <div class="hero">
        <div style="margin-top: 5px; font-size: 18px;">
            <p>עמוד ראשי לאחראי בניין</p>
        </div>
        <h2>שלום {{ user.first_name }} {{ user.last_name }}</h2>
        {% if managed_buildings %}
        <div style="margin-top: 10px; font-size: 16px;">
            <p>אחראי על בניין-
                {% for building in managed_buildings %}
                    {{ building.building_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
        </div>
        {% endif %}
    </div>

    <div class="links">
        <a href="{% url 'BM_inventory' %}">ניהול מלאי</a>
        <a href="{% url 'BM_loan_requests' %}">ניהול השאלות</a>
        <a href="{% url 'BM_faults' %}">ניהול תקלות</a>
        <a href="{% url 'BM_manage_students' %}">ניהול סטודנטים</a>
    </div>

    <!-- ניהול השאלות ציוד -->
    <div class="section">
        <h3>ניהול השאלות ציוד</h3>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            {% if pending_requests_count > 0 %}
            <div style="background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px;">
                <strong>יש לך {{ pending_requests_count }} בקשות השאלה ממתינות לאישור!</strong>
                <div style="margin-top: 10px;">
                    <a href="{% url 'BM_loan_requests' %}" style="display: inline-block; padding: 8px 15px; background-color: #dc3545; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">צפה בבקשות</a>
                </div>
            </div>
            {% endif %}

            {% if borrowed_items_count > 0 %}
            <div style="background-color: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 5px;">
                <strong>יש {{ borrowed_items_count }} פריטים מושאלים שטרם הוחזרו.</strong>
                <div style="margin-top: 10px;">
                    <a href="{% url 'BM_loan_requests' %}#borrowed-items" style="display: inline-block; padding: 8px 15px; background-color: #17a2b8; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">צפה בפריטים מושאלים</a>
                </div>
            </div>
            {% endif %}

            {% if pending_requests_count == 0 and borrowed_items_count == 0 %}
            <p>אין בקשות חדשות או פריטים מושאלים שממתינים לטיפול.</p>
            {% endif %}
        </div>
    </div>

    <!-- ניהול דיווחי תקלות -->
    <div class="section">
        <h3>ניהול דיווחי תקלות</h3>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            {% if open_faults_count > 0 %}
            <div style="background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px;">
                <strong>יש לך {{ open_faults_count }} דיווחי תקלות חדשים לטיפולך!</strong>
                <div style="margin-top: 10px;">
                    <a href="{% url 'BM_faults' %}" style="display: inline-block; padding: 8px 15px; background-color: #dc3545; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">צפה בדיווחים</a>
                </div>
            </div>
            {% endif %}

            {% if pending_faults_count > 0 %}
            <div style="background-color: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 5px;">
                <strong>יש {{ pending_faults_count }} תקלות שעוד לא הסתיים הטיפול בהן.</strong>
                <div style="margin-top: 10px;">
                    <a href="{% url 'BM_faults' %}#pending-faults" style="display: inline-block; padding: 8px 15px; background-color: #17a2b8; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">צפה בתקלות בטיפול</a>
                </div>
            </div>
            {% endif %}

            {% if open_faults_count == 0 and pending_faults_count == 0 %}
            <p>אין דיווחי תקלות חדשים או תקלות בטיפול שממתינות לך.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
